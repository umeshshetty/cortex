<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cortex Architecture</title>
    <script type="module">
        import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
        mermaid.initialize({ startOnLoad: true });
    </script>
    <style>
        body {
            font-family: sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background: #fff;
        }

        .mermaid {
            background: white;
            padding: 20px;
            border-radius: 8px;
        }
    </style>
</head>

<body>
    <div class="mermaid">
        graph TD
        %% Styling
        classDef frontend fill:#e1f5fe,stroke:#01579b,stroke-width:2px;
        classDef backend fill:#e8f5e9,stroke:#2e7d32,stroke-width:2px;
        classDef infra fill:#f3e5f5,stroke:#7b1fa2,stroke-width:2px;
        classDef llm fill:#fff3e0,stroke:#e65100,stroke-width:2px;
        classDef agent fill:#fff9c4,stroke:#fbc02d,stroke-width:2px;

        %% Subgraphs
        subgraph "Frontend Layer"
        UI["React/Vite Dashboard"]:::frontend
        Hooks["Custom Hooks <br />(useAgent)"]:::frontend
        end

        subgraph "Backend Layer (FastAPI)"
        API["Main API Router"]:::backend

        subgraph "Cognitive Layer"
        Router["Intent Router"]:::agent
        Orchestrator["Cognitive Graph Engine"]:::agent

        subgraph "Specialized Agents"
        Scheduler["Scheduler Agent"]:::agent
        Social["Social Agent"]:::agent
        Analyst["Analyst Agent"]:::agent
        Onboarding["Onboarding Agent"]:::agent
        end
        end

        subgraph "LLM Infrastructure (Tiered)"
        Reflex["Reflex Tier <br />(Llama 3.2 Local)"]:::llm
        Private["Private Tier <br />(Mistral Local)"]:::llm
        Logic["Logic Tier <br />(GPT-4o Cloud)"]:::llm
        Empathy["Empathy Tier <br />(Claude 3.5 Cloud)"]:::llm
        end
        end

        subgraph "Data & Async Infrastructure"
        Neo4j[("Neo4j <br />(Knowledge Graph + Vector)")]:::infra
        Redis[("Redis <br />(Working Memory)")]:::infra
        Celery["Celery Workers <br />(Background Tasks)"]:::infra
        Langfuse["Langfuse <br />(Observability)"]:::infra
        end

        %% Connections
        UI <-->|REST API| API
            Hooks --> UI

            API --> Router
            Router -->|Classifies Intent| Orchestrator

            Orchestrator -->|Delegates| Scheduler
            Orchestrator -->|Delegates| Social
            Orchestrator -->|Delegates| Analyst
            Orchestrator -->|Delegates| Onboarding

            %% Agent to LLM Connections
            Router -.->|Fast/Simple| Reflex
            Scheduler -.->|Complex Logic| Logic
            Social -.->|EQ/Tone| Empathy
            Onboarding -.->|Profile Building| Private
            Analyst -.->|Data Processing| Logic

            %% Data Connections
            Orchestrator <-->|RAG / Memories| Neo4j
                Orchestrator <-->|Short-term Context| Redis
                    Celery <-->|Async Jobs| Redis
                        Celery -->| Updates| Neo4j

                        %% Observability
                        API -.->|Traces| Langfuse
                        Orchestrator -.->|Traces| Langfuse

                        %% User Flow
                        User(("User")) --> UI
    </div>
</body>

</html>